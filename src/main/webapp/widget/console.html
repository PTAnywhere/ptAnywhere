<!DOCTYPE html>
<html>
    <head lang="en">
        <meta charset="UTF-8">
        <title>Console</title>
        <style>
            * { margin: 0; padding: 0; box-sizing: border-box; }
            body { font: 13px Helvetica, Arial; }
            #messages { list-style-type: none; margin: 0; padding: 0; }
            #messages li { padding: 5px 10px; }
            #messages li:nth-child(odd) { background: #eee; }
        </style>
        <script src="/webPacketTracer/widget/jquery/jquery.js"></script>
    </head>
    <body>
        <div id="messages"></div>
        <div style="height: 8pt; width: 100%">
            <span id="lastLine" style="float:left;"></span>
            <span id="current" contentEditable="true" style="display: block; height: 100%;">ping 10.0.0.2</span>
        </div>
        <script type="text/javascript">
             var ws = null;

            function setConnected(connected) {
                $('#current').prop( "disabled", !connected);
            }

            function connect(target) {
                console.log('Connecting to websocket endpoint... (' + target + ')');

                if ('WebSocket' in window) {
                    ws = new WebSocket(target);
                } else if ('MozWebSocket' in window) {
                    ws = new MozWebSocket(target);
                } else {
                    alert('WebSocket is not supported by this browser.');
                    return;
                }
                ws.onopen = function () {
                    setConnected(true);
                    console.log('Info: WebSocket connection opened.');
                };
                ws.onmessage = function (event) {
                    var lines = event.data.split("\n");
                    if (lines.length>1) {
                        for (var i=0; i<lines.length-1; i++) { // Unnecessary
                            if (i==0) {
                                $("#messages").append($("#lastLine").text());
                                $("#lastLine").text('');
                            }
                            $("#messages").append(lines[i] + "<br />");
                        }
                    }
                    $("#lastLine").append(lines[lines.length-1]);
                    $("html, body").animate({ scrollTop: $(document).height() }, "slow");  // Scroll down
                };
                ws.onclose = function (event) {
                    setConnected(false);
                    console.log('Info: WebSocket connection closed, Code: ' + event.code + (event.reason == "" ? "" : ", Reason: " + event.reason));
                };
            }

            $(document).keypress(function(e) {
                if(e.which == 13) {
                    ws.send($("#current").text());
                    $("#current").text('');
                }
            });

            $(function() {
                connect( ('ws://'+ window.location.host + window.location.pathname).replace("api", "endpoint") );
            });
        </script>
    </body>
</html>